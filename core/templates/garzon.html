{% load static %}
{% load custom_filters %}
<!DOCTYPE html>
<html lang="es" data-bs-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>COMANDA</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <link rel="stylesheet" href="{% static 'css/garzon.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="icon" href="{% static 'icons/logo.ico' %}" type="image/x-icon">
</head>
<body>

<header>
  <h1>COMANDA</h1>
  <div class="contenedor-links">
    <div class="link">MESAS</div>
    <div class="link">HISTORIAL</div>
  </div>
</header>

<main>
  <!-- Vista de mesas -->
  <section id="vista-mesas">
    <div class="contenedor-mesas">
      {% for i in "12345678910"|make_list %}
        <div class="mesa" onclick="abrirCarta('Mesa 0{{ i }}')">Mesa 0{{ i }}</div>
      {% endfor %}
    </div>
  </section>

  <!-- Vista crear comanda -->
  <section id="vista-carta" class="oculto">
    <div class="registrar-comanda-izquierda">

      <div class="registrar-comanda-izquierda-arriba">
        <button onclick="volver()">
          <img src="{% static 'icons/volver-white.png' %}" alt="">
        </button>
        <h2 id="titulo-mesa">Menú</h2>
      </div>

      <div class="registrar-comanda-izquierda-abajo">
        <div class="tabs-categorias">
          {% for categoria in categorias %}
            <button data-categoria="{{ categoria.nombre }}" {% if forloop.first %}class="tab-activa"{% endif %}>
              {{ categoria.nombre|pretty_name }}
            </button>
          {% endfor %}
          <button data-categoria="Bebestibles">Bebestibles</button>
        </div>
      </div>

      <div class="registrar-comanda-izquierda-final">
        <div class="productos">
          {% for producto in productos %}
            <div class="producto" data-categoria="{{ producto.categoria.nombre }}" onclick="mostrarModal('{{ producto.id }}')">
              <img src="{% static producto.imagen %}" alt="{{ producto.nombre }}" />
              <p>{{ producto.nombre }}<br><strong>{{ producto.precio_humanizado }}</strong></p>
            </div>
          {% endfor %}

          {% for bebestible in bebestibles %}
            <div class="producto" data-categoria="Bebestibles">
              <img src="{% static bebestible.imagen %}" alt="{{ bebestible.nombre }}" />
              <p>{{ bebestible.nombre }}<br><strong>{{ bebestible.precio_humanizado }}</strong></p>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="registrar-comanda-centro"></div>

    <div class="registrar-comanda-derecha">
      <div class="registrar-comanda-derecha-arriba">
        <div class="registrar-comanda-garzon">
          <h1>Garzón Franco</h1>
        </div>

        <div class="registrar-comanda-numero-clientes">
          <i class="fa-solid fa-user" style="color: white;"></i>
          <span id="numero-seleccionado">1</span>
          <button class="boton-dropdown" onclick="toggleDropdown()">
            <i class="fa-solid fa-chevron-down"></i>
          </button>
          <div id="dropdown-numeros" class="dropdown oculto">
            {% for i in "123456"|make_list %}
              <div onclick="seleccionarNumero({{ i }})">{{ i }}</div>
            {% endfor %}
            <div onclick="seleccionarOtro()">Otro</div>
            <input id="input-otro" class="oculto" type="number" placeholder="Ingresa número" oninput="actualizarNumero(this.value)">
          </div>
        </div>

        <div class="registrar-comanda-mesa">
          <span id="mesa-seleccionada"><strong>Mesa 1</strong></span>
          <button class="boton-editar-mesa" onclick="toggleSelectorMesas()">
            <i class="fa-solid fa-pen-to-square"></i>
          </button>
          <div id="selector-mesas" class="selector-mesas oculto">
            {% for i in "12345678910"|make_list %}
              <div onclick="seleccionarMesa('Mesa 0{{ i }}')">Mesa 0{{ i }}</div>
            {% endfor %}
          </div>
        </div>
      </div>

      <div class="registrar-comanda-derecha-medio">
        <div class="registrar-comanda-derecha-medio-n-pedido">
          <h1>Pedido 1</h1>
        </div>
        <div class="registrar-comanda-derecha-medio-pedido-contenedor">
          <!-- Productos agregados al pedido aparecerán aquí -->
        </div>
      </div>

      <div class="registrar-comanda-derecha-precio">
        <h1>Total:</h1>
        <h1>$0</h1>
      </div>

      <div class="registrar-comanda-derecha-buttons">
        <button id="cancelar-comanda">Cancelar</button>
        <button id="entregar-comanda">Entregar</button>
        <button id="enviar-comanda">Enviar</button>
      </div>
    </div>

    <!-- Modales de productos -->
    {% for producto in productos %}
    <div class="modal fade" id="modalProducto{{ producto.id }}" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="contenedor-modal-personalizado">

            <div class="contenedor-modal-inicio">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">X</button>
            </div>

            <div class="contenedor-modal-divisor">
              <div class="contenedor-modal-izquierda">
                <img src="{% static producto.imagen %}" alt="{{ producto.nombre }}">
              </div>

              <div class="contenedor-modal-derecha">
                <div class="contenedor-modal-items-centrados">
                  <h1>{{ producto.nombre }}</h1>
                  <p>{{ producto.descripcion }}</p>
                  <h2>{{ producto.precio_humanizado }}</h2>
                </div>

                <div class="contenedor-aderezos-modal mb-3">
                  <label class="form-label">Ingredientes (puedes quitar)</label>
                  {% for ingrediente in producto.ingredientes.all %}
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" checked id="ingrediente{{ producto.id }}-{{ ingrediente.id }}">
                    <label class="form-check-label" for="ingrediente{{ producto.id }}-{{ ingrediente.id }}">
                      {{ ingrediente.nombre }}
                    </label>
                  </div>
                  {% endfor %}
                </div>

                <div class="contenedor-ingredientes-extra mb-3">
                  <label class="form-label">Acompañamientos (el primero gratis)</label>
                  {% for acompanamiento in acompanamientos %}
                  <div class="form-check">
                    <input class="form-check-input acompanamiento-extra" type="checkbox" name="acompanamientos" value="{{ acompanamiento.id }}" data-precio="{{ acompanamiento.precio }}" id="acompanamiento{{ producto.id }}-{{ acompanamiento.id }}">
                    <label class="form-check-label" for="acompanamiento{{ producto.id }}-{{ acompanamiento.id }}">
                      {{ acompanamiento.nombre }} {% if acompanamiento.precio > 0 %}(+${{ acompanamiento.precio }}){% endif %}
                    </label>
                  </div>
                  {% endfor %}
                </div>
              </div>
            </div>

            <div class="modal-footer px-0">
              <div class="contenedor-modal-agregar-mas-productos">
                <button class="btn-restar" data-id="{{ producto.id }}"><</button>
                <h1 id="cantidad-{{ producto.id }}">1</h1>
                <button class="btn-sumar" data-id="{{ producto.id }}">></button>
              </div>
              <button type="button" class="btn btn-primary" id="btn-agregar-{{ producto.id }}" data-precio-base="{{ producto.precio }}">
                AGREGAR {{ producto.precio_humanizado }}
              </button>
            </div>

          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </section>
</main>

<script src="{% static 'js/garzon.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</body>
</html>
